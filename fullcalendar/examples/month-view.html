<!DOCTYPE html>
<html>

<head>
  <meta charset='utf-8' />
  <title>{TITLE PLACEHOLDER}</title>
  <meta charset="UTF-8">
  <link rel="icon" type="image/x-icon" href="../../../favicon.ico">
  <meta name="msapplication-TileColor" content="#ffffff" />
  <meta name="msapplication-TileImage" content="../../../assets/easter-egg-5-144-279148.png">
  <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../../assets/img/easter-egg-5-152-279148.png">
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../../../assets/img/easter-egg-5-144-279148.png">
  <link rel="apple-touch-icon-precomposed" sizes="120x120" href="../../../assets/img/easter-egg-5-120-279148.png">
  <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../../../assets/img/easter-egg-5-114-279148.png">
  <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../../../assets/img/easter-egg-5-72-279148.png">
  <link rel="apple-touch-icon-precomposed" href="../../../assets/img/easter-egg-5-57-279148.png">
  <link rel="icon" href="../../../assets/img/easter-egg-5-32-279148.png" sizes="32x32">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css">
  <link href='https://cdn.jsdelivr.net/npm/fullcalendar@5.2.0/main.min.css' rel='stylesheet' />
  <link href="styles.css" rel="stylesheet" />
</head>

<body>
  <div id="spinnerWrapper">
    <div class="lds-roller">
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
      <div></div>
    </div>
  </div>
  <div><a class="backNav" href="https://litcal.johnromanodorazio.com/usage.php">↩ Go back ↩</a></div>
  <span class="material-icons" id="openSettings">settings</span>
  <header></header>

  <div id='calendar'></div>

  <footer></footer>

  <table id="LitCalMessages">
    <thead></thead>
    <tbody></tbody>
  </table>
  <script src='https://cdn.jsdelivr.net/npm/fullcalendar@5.2.0/main.min.js'></script>
  <script src='https://cdn.jsdelivr.net/npm/fullcalendar@5.2.0/locales-all.min.js'></script>
  <script src='../la.js'></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
  <script>
    "use strict";
    const thirdLevelDomain = window.location.hostname.split('.')[0];
    const isStaging = ( thirdLevelDomain.includes( '-staging' ) || window.location.pathname.includes( '-staging' ) );
    const stagingURL = isStaging ? '-staging' : '';
    const endpointV = isStaging ? 'dev' : 'v3';
    const endpointURL = `https://litcal.johnromanodorazio.com/api/${endpointV}/LitCalEngine.php`;
    const metadataURL = `https://litcal.johnromanodorazio.com/api/${endpointV}/LitCalMetadata.php`;
    let noticeShown = false;
    let today = new Date(),
      $Settings = {
        "year": today.getFullYear(),
        "epiphany": "JAN6",
        "ascension": "SUNDAY",
        "corpuschristi": "SUNDAY",
        "locale": "LA",
        "returntype": "JSON"
      },
      $events = [],
      pad = n => (n < 10 ? '0' + n : n),
      genLitCal = () => {
        $.ajax({
          method: 'POST',
          data: $Settings,
          url: endpointURL,
          success: LitCalData => {
            console.log(LitCalData);
            if (LitCalData.hasOwnProperty("LitCal")) {
              createHeader();
              let $LitCal = LitCalData.LitCal;

              for (let key in $LitCal) {
                $LitCal[key].date = new Date($LitCal[key].date * 1000); //transform PHP timestamp to javascript date object
              }
              let $LitCalKeys = Object.keys($LitCal);
              for (let $keyindex = 0; $keyindex < $LitCalKeys.length; $keyindex++) {
                let $keyname = $LitCalKeys[$keyindex];
                let $festivity = $LitCal[$keyname];
                let dy = ($festivity.date.getDay() === 0 ? 7 : $festivity.date.getDay()); // get the day of the week
                let $possibleColors = $festivity.color.split(",");
                let $CSScolor = $possibleColors[0];
                let $textColor = ($CSScolor === 'white' || $CSScolor === 'pink' ? 'black' : 'white');
                let $festivityGrade = '';
                if ($festivity.hasOwnProperty('displayGrade') && $festivity.displayGrade !== '') {
                  $festivityGrade = $festivity.displayGrade + ', ';
                }
                else if (dy !== 7 || $festivity.grade > 3) {
                  $festivityGrade = _G($festivity.grade) + ', ';
                }
                let $psalterWeek = $festivity.hasOwnProperty('psalterWeek') ? 'Ps W' + $festivity.psalterWeek : '';
                let $liturgicalYear = $festivity.hasOwnProperty('liturgicalYear') ? '<br>' + $festivity.liturgicalYear + ($psalterWeek != '' ? ' | ' + $psalterWeek : '') : ($psalterWeek != '' ? $psalterWeek : '');

                let $description = '<b>' + $festivity.name + '</b><br>' + $festivityGrade + '<i>' + _CC($festivity.color, true) + '</i><br><i style="font-size:.8em;">' + _C($festivity.common) + '</i>' + $liturgicalYear;
                $events[$keyindex] = {
                  title: $festivity.name,
                  start: $festivity.date.getUTCFullYear() + '-' + pad($festivity.date.getUTCMonth() + 1) + '-' + pad($festivity.date.getUTCDate()),
                  backgroundColor: $CSScolor,
                  textColor: $textColor,
                  description: $description,
                  idx: $festivity.eventIdx
                };

                if ($keyindex === $LitCalKeys.length - 1) {
                  $('#spinnerWrapper').fadeOut('slow');
                }
              }

              let calendarEl = document.getElementById('calendar'),
                fullCalendarSettings = {
                  headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'dayGridMonth,listMonth'
                  },
                  dayMaxEvents: true, // allow "more" link when too many events
                  events: $events,
                  firstDay: 0,
                  eventOrder: 'idx',
                  aspectRatio: 2,
                  eventDidMount: info => { $(info.el).attr('data-tooltip', encodeURI(info.event.extendedProps.description)); }
                  //monthNames: ["januari", "februari", "maart", "april", "mei", "juni","juli", "augustus", "september", "oktober", "november", "december"],
                  //monthNamesShort: ["jan", "feb", "maa", "apr", "mei", "jun", "jul", "aug","sep", "okt", "nov", "dec"],
                  //dayNames: ['zondag', 'maandag', 'dinsdag', 'woensdag','donderdag', 'vrijdag', 'zaterdag'],
                  //dayNamesShort: ["zo", "ma", "di", "wo", "do", "vr", "za", "zo"]
                };
              if ($Settings.locale.toLowerCase() !== 'en') {
                fullCalendarSettings.locale = $Settings.locale.toLowerCase();
              }
              if (parseInt($Settings.year) !== today.getFullYear()) {
                fullCalendarSettings.initialDate = $Settings.year + '-01-01';
              }
              let calendar = new FullCalendar.Calendar(calendarEl, fullCalendarSettings);

              calendar.render();
            }

            if (LitCalData.hasOwnProperty('Messages')) {
              $('#LitCalMessages tbody').empty();
              LitCalData.Messages.forEach((message, idx) => { $('#LitCalMessages tbody').append(`<tr><td>${idx}</td><td>${message}</td></tr>`); });
            }

            if(LitCalData.hasOwnProperty('Metadata')) {
              if(!noticeShown){
                //let's check the current version against the latest stable version published
                $.ajax({
                  method: "GET",
                  url: "https://api.github.com/repos/JohnRDOrazio/LiturgicalCalendar/releases/latest",
                  headers: { 
                      Accept : "application/vnd.github.v3+json"
                  },
                  success: MetaData => {
                    console.log('data received from github:');
                    console.log(MetaData);
                    if(typeof MetaData ==='object' && MetaData.hasOwnProperty('tag_name')){
                      let $latestStable = parseFloat(MetaData.tag_name.replace('v',''));
                      let $currentVersion = parseFloat(LitCalData.Metadata.VERSION);
                      if($currentVersion > $latestStable){
                        $('<div>',{ 
                          id: 'noticeExperimentalVersion', 
                          html: __( 'This example page is using a development version of the LiturgicalCalendar endpoint.<br>The latest <b>stable</b> version is <b>{0}</b>, this page is using version <b>{1}</b> (not yet released). There may be features that have not yet been fully tested.' ).format( `<a href="${MetaData.html_url}">${$latestStable}</a>`, LitCalData.Metadata.VERSION)
                        }).dialog({modal:true,title:"Notice Experimental Version",width:'40%'});
                        noticeShown = true;
                      }
                    }
                  }
                });
              }
            }

          },
          error: (jqXHR, textStatus, errorThrown) => {
            console.log('(' + textStatus + ') ' + errorThrown);
            console.log(jqXHR.getAllResponseHeaders);
            console.log(jqXHR.responseText);
          }
        });
      },
      createHeader = () => {
        document.title = __("Generate Roman Calendar");
        $('#settingsWrapper').dialog("destroy").remove();
        $('header').empty();
        let templateStr = __('HTML presentation elaborated by JAVASCRIPT using an AJAX request to a %s');
        templateStr = templateStr.replace('%s', `<a href="${endpointURL}">PHP engine</a>`);
        let $header = `
            <h1 style="text-align:center;">${__('Liturgical Calendar Calculation for a Given Year')} (${$Settings.year})</h1>
            <h5 style="text-align:center;">${templateStr}</h5>`,
          $footer = `<div style="text-align:center;border:2px groove White;border-radius:6px;width:60%;margin:0px auto;padding-bottom:6px;">
            <h3>${__('Configurations being used to generate this calendar:')}</h3>
            <span>${__('YEAR')} = ${$Settings.year}, ${__('EPIPHANY')} = ${$Settings.epiphany}, ${__('ASCENSION')} = ${$Settings.ascension}, CORPUS CHRISTI = ${$Settings.corpuschristi}, LOCALE = ${$Settings.locale}</span>
            </div>`,
          $tbheader = `<tr><th>${__("Month")}</th><th>${__("Date in Gregorian Calendar")}</th><th>${__("General Roman Calendar Festivity")}</th><th>${__("Grade of the Festivity")}</th></tr>`,
          $settingsDialog = `<div id="settingsWrapper"><form id="calSettingsForm"><table id="calSettings">
        <tr><td colspan="2"><label>${__('YEAR')}: </td><td colspan="2"><input type="number" name="year" id="year" min="1969" max="9999" value="${$Settings.year}" /></label></td></tr>
        <tr><td><label>${__('LOCALE')}: </td><td><select name="locale" id="locale"><option value="EN" ${($Settings.locale === "EN" ? " SELECTED" : "")}>ENGLISH</option><option value="IT" ${($Settings.locale === "IT" ? " SELECTED" : "")}>ITALIANO</option><option value="LA" ${($Settings.locale === "LA" ? " SELECTED" : "")}>LATINO</option></select></label></td><td>${__('NATIONAL PRESET')}: </td><td><select id="nationalcalendar" name="nationalcalendar"><option value=""></option><option value="VATICAN" ${($Settings.nationalcalendar === "VATICAN" ? " SELECTED" : "")}>${__('Vatican')}</option><option value="ITALY" ${($Settings.nationalcalendar === "ITALY" ? " SELECTED" : "")}>${__('Italy')}</option><option value="USA" ${($Settings.nationalcalendar === "USA" ? " SELECTED" : "")}>USA</option></select></td></tr>
        <tr><td><label>${__('EPIPHANY')}: </td><td><select name="epiphany" id="epiphany"><option value="JAN6" ${($Settings.epiphany === "JAN6" ? " SELECTED" : "")}>${__('January 6')}</option><option value="SUNDAY_JAN2_JAN8" ${($Settings.epiphany === "SUNDAY_JAN2_JAN8" ? " SELECTED" : "")}>${__('Sunday Jan 2↔Jan 8')}</option></select></label></td><td>${__('DIOCESAN PRESET')}: </td><td><select id="diocesancalendar" name="diocesancalendar" ${($Settings.nationalcalendar == '' || $Settings.nationalcalendar == 'VATICAN' ) ? 'disabled' : ''}></select></td></tr>
        <tr><td><label>${__('ASCENSION')}: </td><td><select name="ascension" id="ascension"><option value="THURSDAY" ${($Settings.ascension === "THURSDAY" ? " SELECTED" : "")}>${__('Thursday')}</option><option value="SUNDAY" ${($Settings.ascension === "SUNDAY" ? " SELECTED" : "")}>${__('Sunday')}</option></select></label></td><td></td><td></td></tr>
        <tr><td><label>CORPUS CHRISTI: </td><td><select name="corpuschristi" id="corpuschristi"><option value="THURSDAY" ${($Settings.corpuschristi === "THURSDAY" ? " SELECTED" : "")}>${__('Thursday')}</option><option value="SUNDAY" ${($Settings.corpuschristi === "SUNDAY" ? " SELECTED" : "")}>${__('Sunday')}</option></select></label></td><td></td><td></td></tr>
        <tr><td colspan="4" style="text-align:center;"><input type="submit" id="generateLitCal" value="${__("Generate Roman Calendar")}" /></td></tr>
        </table></form></div>`;
        $('header').html($header);
        $('footer').html($footer);
        $('#LitCalTable thead').html($tbheader);
        $('#LitCalMessages thead').html(`<tr><th colspan=2 style="text-align:center;">${__("Information about the current calculation of the Liturgical Year")}</th></tr>`);
        $('#generateLitCal').button();

        $($settingsDialog).dialog({
          title: __('Customize options for generating the Roman Calendar'),
          modal: true,
          width: '80%',
          show: {
            effect: 'fade',
            duration: 500
          },
          hide: {
            effect: 'fade',
            duration: 500
          },
          autoOpen: false
        });

        if($Settings.nationalcalendar === 'USA'){
            if(Object.keys($DiocesesUSA).length > 0){
                $('#diocesancalendar').prop('disabled', false);
                $('#diocesancalendar').append('<option value=""></option>');
                for(const [key, value] of Object.entries($DiocesesUSA)){
                    $('#diocesancalendar').append('<option value="' + key + '">' + value.diocese + '</option>');
                }
            } else {
                $('#diocesancalendar').prop('disabled', true);
            }
        } else if ($Settings.nationalcalendar === 'ITALY'){
            if(Object.keys($DiocesesItaly).length > 0){
                $('#diocesancalendar').prop('disabled', false);
                $('#diocesancalendar').append('<option value=""></option>');
                for(const [key, value] of Object.entries($DiocesesItaly)){
                    $('#diocesancalendar').append('<option value="' + key + '">' + value.diocese + '</option>');
                }
            } else {
                $('#diocesancalendar').prop('disabled', true);
            }
        }

      },
      __ = $key => {
        let $lcl = $Settings.locale.toLowerCase();
        if ($messages !== null && typeof $messages == 'object') {
          if ($messages.hasOwnProperty($key) && typeof $messages[$key] == 'object') {
            if ($messages[$key].hasOwnProperty($lcl)) {
              return $messages[$key][$lcl];
            } else {
              return $messages[$key]["en"];
            }
          } else {
            return $key;
          }
        } else {
          return $key;
        }
      },
      _G = ($key, $html = true) => {
        $key = parseInt($key);
        let $grade = __("FERIA");
        switch ($key) {
          case 0:
            $grade = __("FERIA");
            break;
          case 1:
            $grade = __("COMMEMORATION");
            break;
          case 2:
            $grade = __("OPTIONAL MEMORIAL");
            break;
          case 3:
            $grade = __("MEMORIAL");
            break;
          case 4:
            $grade = __("FEAST");
            break;
          case 5:
            $grade = __("FEAST OF THE LORD");
            break;
          case 6:
            $grade = __("SOLEMNITY");
            break;
          case 7:
            $grade = __("HIGHER RANKING SOLEMNITY");
            break;
        }
        return $html === true ? $grade : strip_tags($grade);
      },
      _C = $common => {
        if ($common !== "" && $common !== "Proper") {
          let $commons = $common.split(",");
          $commons = $commons.map($txt => {
            let $commonArr = $txt.split(":");
            let $commonGeneral = __($commonArr[0]);
            let $commonSpecific = $commonArr.length > 1 && $commonArr[1] != "" ? __($commonArr[1]) : "";
            let $commonKey = '';
            //$txt = str_replace(":", ": ", $txt);
            switch ($commonGeneral) {
              case __("Dedication of a Church"):
                $commonKey = "of (SING_FEMM)";
                break;
              case __("Blessed Virgin Mary"):
                $commonKey = "of (SING_FEMM)";
                break;
              case __("Virgins"):
                $commonKey = "of (PLUR_FEMM)";
                break;
              case __("Martyrs"):
              case __("Pastors"):
              case __("Doctors"):
              case __("Holy Men and Women"):
                $commonKey = "of (PLUR_MASC)";
                break;
              default:
                $commonKey = "of (SING_MASC)";
            }
            return __("From the Common") + " " + __($commonKey) + " " + $commonGeneral + ($commonSpecific != "" ? ": " + $commonSpecific : "");
          });
          $common = $commons.join("; " + __("or") + " ");
        } else if ($common == "Proper") {
          $common = __("Proper");
        }
        return $common;
      },
      _CC = ($colorstr, html) => {
        if (html === true) {
          if ($colorstr.indexOf(',') !== -1) {
            console.log($colorstr);
            let $colors = $colorstr.split(",");
            $colors = $colors.map($txt => {
              let $clr = $txt === 'white' ? 'gray' : $txt;
              return '<span style="color:' + $clr + ';">' + __($txt) + '</span>';
            });
            return $colors.join(" " + __("or") + " ");
          }
          else {
            let $highlightColor = $colorstr === 'pink' ? 'text-shadow:1px 1px 3px Black;font-weight:bold;' : '';
            return '<span style="color:' + ($colorstr === 'white' ? 'gray' : $colorstr) + ';' + $highlightColor + '">' + __($colorstr) + '</span>';
          }
        }
        else {
          if ($colorstr.indexOf(',') !== -1) {
            console.log($colorstr);
            let $colors = $colorstr.split(",");
            $colors = $colors.map($txt => {
              return __($txt);
            });
            return $colors.join(" " + __("or") + " ");
          }
          else {
            return __($colorstr);
          }
        }
      },
      $messages = {
        "From the Common": {
          "en": "From the Common",
          "it": "Dal Comune",
          "la": "De Communi"
        },
        "of (SING_MASC)": {
          "en": "of",
          "it": "del",
          "la": ""
        },
        "of (SING_FEMM)": {
          "en": "of the",
          "it": "della",
          "la": ""
        },
        "of (PLUR_MASC)": {
          "en": "of",
          "it": "dei",
          "la": ""
        },
        "of (PLUR_MASC_ALT)": {
          "en": "of",
          "it": "degli",
          "la": ""
        },
        "of (PLUR_FEMM)": {
          "en": "of",
          "it": "delle",
          "la": ""
        },
        "Dedication of a Church": {
          "en": "Dedication of a Church",
          "it": "Dedicazione di una Chiesa",
          "la": "Dedicationis ecclesiæ"
        },
        /*translators: in reference to the Common of the Blessed Virgin Mary */
        "Blessed Virgin Mary": {
          "en": "Blessed Virgin Mary",
          "it": "Beata Vergine Maria",
          "la": "Beatæ Virginis Mariæ"
        },
        "Martyrs": {
          "en": "Martyrs",
          "it": "Martiri",
          "la": "Martyrum"
        },
        "Pastors": {
          "en": "Pastors",
          "it": "Pastori",
          "la": "Pastorum"
        },
        "Doctors": {
          "en": "Doctors",
          "it": "Dottori della Chiesa",
          "la": "Doctorum Ecclesiae"
        },
        "Virgins": {
          "en": "Virgins",
          "it": "Vergini",
          "la": "Virginum"
        },
        "Holy Men and Women": {
          "en": "Holy Men and Women",
          "it": "Santi e delle Sante",
          "la": "Sanctorum et Sanctarum"
        },
        "For One Martyr": {
          "en": "For One Martyr",
          "it": "Per un martire",
          "la": "Pro uno martyre"
        },
        "For Several Martyrs": {
          "en": "For Several Martyrs",
          "it": "Per più martiri",
          "la": "Pro pluribus martyribus"
        },
        "For Missionary Martyrs": {
          "en": "For Missionary Martyrs",
          "it": "Per i martiri missionari",
          "la": "Pro missionariis martyribus"
        },
        "For a Virgin Martyr": {
          "en": "For a Virgin Martyr",
          "it": "Per una vergine martire",
          "la": "Pro virgine martyre"
        },
        "For Several Pastors": {
          "en": "For Several Pastors",
          "it": "Per i pastori",
          "la": "Pro Pastoribus"
        },
        "For a Pope": {
          "en": "For a Pope",
          "it": "Per i papi",
          "la": "Pro Papa"
        },
        "For a Bishop": {
          "en": "For a Bishop",
          "it": "Per i vescovi",
          "la": "Pro Episcopo"
        },
        "For One Pastor": {
          "en": "For One Pastor",
          "it": "Per un Pastore",
          "la": "Pro Pastoribus"
        },
        "For Missionaries": {
          "en": "For Missionaries",
          "it": "Per i missionari",
          "la": "Pro missionariis"
        },
        "For One Virgin": {
          "en": "For One Virgin",
          "it": "Per una vergine",
          "la": "Pro una virgine"
        },
        "For Several Virgins": {
          "en": "For Several Virgins",
          "it": "Per più vergini",
          "la": "Pro pluribus virginibus"
        },
        "For Religious": {
          "en": "For Religious",
          "it": "Per i religiosi",
          "la": "Pro Religiosis"
        },
        "For Those Who Practiced Works of Mercy": {
          "en": "For Those Who Practiced Works of Mercy",
          "it": "Per gli operatori di misericordia",
          "la": "Pro iis qui opera Misericordiæ Exercuerunt"
        },
        "For an Abbot": {
          "en": "For an Abbot",
          "it": "Per un abate",
          "la": "Pro abbate"
        },
        "For a Monk": {
          "en": "For a Monk",
          "it": "Per un monaco",
          "la": "Pro monacho"
        },
        "For a Nun": {
          "en": "For a Nun",
          "it": "Per i religiosi",
          "la": "Pro moniali"
        },
        "For Educators": {
          "en": "For Educators",
          "it": "Per gli educatori",
          "la": "Pro Educatoribus"
        },
        "For Holy Women": {
          "en": "For Holy Women",
          "it": "Per le sante",
          "la": "Pro Sanctis Mulieribus"
        },
        "For One Saint": {
          "en": "For One Saint",
          "it": "Per un Santo",
          "la": "Pro uno Sancto"
        },
        "or": {
          "en": "or",
          "it": "oppure",
          "la": "vel"
        },
        "Proper": {
          "en": "Proper",
          "it": "Proprio",
          "la": "Proprium"
        },
        "green": {
          "en": "green",
          "it": "verde",
          "la": "viridis"
        },
        "purple": {
          "en": "purple",
          "it": "viola",
          "la": "purpura"
        },
        "white": {
          "en": "white",
          "it": "bianco",
          "la": "albus"
        },
        "red": {
          "en": "red",
          "it": "rosso",
          "la": "ruber"
        },
        "pink": {
          "en": "pink",
          "it": "rosa",
          "la": "rosea"
        },
        "Customize options for generating the Roman Calendar": {
          "en": "Customize options for generating the Roman Calendar",
          "it": "Personalizza le opzioni per la generazione del Calendario Romano",
          "la": "Elige optiones per generationem Calendarii Romani"
        },
        "Generate Roman Calendar": {
          "en": "Generate Roman Calendar",
          "it": "Genera Calendario Romano",
          "la": "Calendarium Romanum Generare"
        },
        "Liturgical Calendar Calculation for a Given Year": {
          "en": "Liturgical Calendar Calculation for a Given Year",
          "it": "Calcolo del Calendario Liturgico per un dato anno",
          "la": "Computus Calendarii Liturgici pro anno dedi"
        },
        "HTML presentation elaborated by JAVASCRIPT using an AJAX request to a %s": {
          "en": "HTML presentation elaborated by JAVASCRIPT using an AJAX request to a %s",
          "it": "Presentazione HTML elaborata con JAVASCRIPT usando una richiesta AJAX al motore PHP %s",
          "la": "Repraesentatio HTML elaborata cum JAVASCRIPT utendo petitionem AJAX ad machinam PHP %s"
        },
        "You are requesting a year prior to 1970: it is not possible to request years prior to 1970.": {
          "en": "You are requesting a year prior to 1970: it is not possible to request years prior to 1970.",
          "it": "Stai effettuando una richiesta per un anno che è precedente al 1970: non è possibile richiedere anni precedenti al 1970.",
          "la": "Rogavisti annum ante 1970: non potest rogare annos ante annum 1970."
        },
        "Customize options for generating the Roman Calendar": {
          "en": "Customize options for generating the Roman Calendar",
          "it": "Personalizzare le opzioni per la generazione del Calendario Romano",
          "la": "Eligere optiones per generationem Calendarii Romani"
        },
        "Configurations being used to generate this calendar:": {
          "en": "Configurations being used to generate this calendar:",
          "it": "Configurazioni utilizzate per la generazione di questo calendario:",
          "la": "Optiones electuus ut generare hic calendarium:"
        },
        "Date in Gregorian Calendar": {
          "en": "Date in Gregorian Calendar",
          "it": "Data nel Calendario Gregoriano",
          "la": "Dies in Calendario Gregoriano"
        },
        "General Roman Calendar Festivity": {
          "en": "General Roman Calendar Festivity",
          "it": "Festività nel Calendario Romano Generale",
          "la": "Festivitas in Calendario Romano Generale"
        },
        "Grade of the Festivity": {
          "en": "Grade of the Festivity",
          "it": "Grado della Festività",
          "la": "Gradum Festivitatis"
        },
        "YEAR": {
          "en": "YEAR",
          "it": "ANNO",
          "la": "ANNUM"
        },
        "EPIPHANY": {
          "en": "EPIPHANY",
          "it": "EPIFANIA",
          "la": "EPIPHANIA"
        },
        "ASCENSION": {
          "en": "ASCENSION",
          "it": "ASCENSIONE",
          "la": "ASCENSIO",
        },
        "Month": {
          "en": "Month",
          "it": "Mese",
          "la": "Mensis"
        },
        "FERIA": {
          "en": "<i>weekday</i>",
          "it": "<i>feria</i>",
          "la": "<i>feria</i>"
        },
        "COMMEMORATION": {
          "en": "Commemoration",
          "it": "Commemorazione",
          "la": "Commemoratio"
        },
        "OPTIONAL MEMORIAL": {
          "en": "Optional memorial",
          "it": "Memoria facoltativa",
          "la": "Memoria ad libitum"
        },
        "MEMORIAL": {
          "en": "Memorial",
          "it": "Memoria",
          "la": "Memoria"
        },
        "FEAST": {
          "en": "Feast",
          "it": "Festa",
          "la": "Festum"
        },
        "FEAST OF THE LORD": {
          "en": "Feast of the Lord",
          "it": "Festa del Signore",
          "la": "Festa Domini"
        },
        "SOLEMNITY": {
          "en": "Solemnity",
          "it": "Solennità",
          "la": "Sollemnitas"
        },
        "HIGHER RANKING SOLEMNITY": {
          "en": "<i>precedence over solemnities</i>",
          "it": "<i>precedenza sulle solennità</i>",
          "la": "<i>præcellentia ante solemnitates</i>"
        },
        "Information about the current calculation of the Liturgical Year": {
          "en": "Information about the current calculation of the Liturgical Year",
          "it": "Informazioni sull'attuale calcolo dell'Anno Liturgico",
          "la": "Notitiæ de computatione præsente Anni Liturgici"
        },
        "LOCALE": {
          "en": "LANGUAGE",
          "it": "LINGUA",
          "la": "LINGUA"
        },
        "NATIONAL PRESET": {
          "en": "NATIONAL PRESET",
          "it": "NAZIONE",
          "la": "PATRIA"
        },
        "DIOCESAN PRESET": {
          "en": "DIOCESAN PRESET",
          "it": "DIOCESI",
          "la": "DIOECESIS"
        },
        "Sunday": {
          "en": "Sunday",
          "it": "Domenica",
          "la": "Dies Domini"
        },
        "Thursday": {
          "en": "Thursday",
          "it": "Giovedì",
          "la": "Dies Iovis"
        },
        "January 6": {
          "en": "January 6",
          "it": "6 Gennaio",
          "la": "6 Ianuarii"
        },
        "Sunday Jan 2↔Jan 8": {
          "en": "Sunday Jan 2↔Jan 8",
          "it": "Domenica 2 Gen↔8 Gen",
          "la": "Dies Iovis 2 Ian↔8 Ian"
        },
        "Italy": {
          "en": "Italy",
          "it": "Italia",
          "la": "Italia"
        },
        "Vatican": {
          "en": "Vatican",
          "it": "Vaticano",
          "la": "Vaticanum"
        },
        "This example page is using a development version of the LiturgicalCalendar endpoint.<br>The latest <b>stable</b> version is <b>{0}</b>, this page is using version <b>{1}</b> (not yet released). There may be features that have not yet been fully tested.": {
          "en": "This example page is using a development version of the LiturgicalCalendar endpoint.<br>The latest <b>stable</b> version is <b>{0}</b>, this page is using version <b>{1}</b> (not yet released). There may be features that have not yet been fully tested.",
          "it": "Questa pagina di esempio utilizza una versione di sviluppo delle API del Calendario Liturgico.<br>L'ultima versione <b>stabile</b> è <b>{0}</b>, questa pagina però sta usando la versione <b>{1}</b> (non ancora pubblicata). Potrebbero esserci delle caratteristiche non ancora pienamente testate.",
          "la": "Questa pagina di esempio utilizza una versione di sviluppo delle API del Calendario Liturgico.<br>L'ultima versione <b>stabile</b> è <b>{0}</b>, questa pagina però sta usando la versione <b>{1}</b> (non ancora pubblicata). Potrebbero esserci delle caratteristiche non ancora pienamente testate."
        }
      },
      dayNames = ['Dies Solis', 'Dies Lunae', 'Dies Martis', 'Dies Mercurii', 'Dies Iovis', 'Dies Veneris', 'Dies Saturni'],
      dayNamesShort = ['Sol', 'Lun', 'Mart', 'Merc', 'Iov', 'Ven', 'Sat'],
      $index = {},
      $DiocesesUSA,
      $DiocesesItaly,
      $DiocesesList;

    jQuery.ajax({
        url: metadataURL,
        dataType: 'json',
        statusCode: {
            404: () => { console.log('The JSON definition "nations/index.json" does not exist yet.'); }
        },
        success: data => {
            console.log('retrieved data from index file:');
            console.log(data);
            $index = data;
            $DiocesesUSA = Object.filter($index, key => key.nation == "USA");
            $DiocesesItaly = Object.filter($index, key => key.nation == "ITALY");
        }
    });

    $(document).ready(() => {
      document.title = __("Generate Roman Calendar");
      $('.backNav').attr('href',`https://litcal${stagingURL}.johnromanodorazio.com/usage.php`);
      createHeader();
      genLitCal();
      $(document).on('click', '#openSettings', ev => { $('#settingsWrapper').dialog("open"); });

      $(document).on("submit", '#calSettingsForm', event => {
        event.preventDefault();
        let formValues = $(event.currentTarget).serializeArray();
        for (let obj of formValues) {
          $Settings[obj.name] = obj.value;
        }

        console.log('$Settings = ');
        console.log($Settings);

        $('#settingsWrapper').dialog("close");
        genLitCal();
        return false;
      });

      $(document).on('change', '#nationalcalendar', ev => {
        /*
        $('#diocesancalendar').empty();
        if(Object.keys($index).length > 0){
          $DiocesesList = Object.filter($index, key => key.nation == $(this).val());
        }
        if(Object.keys($DiocesesList).length > 0){
          $('#diocesancalendar').prop('disabled', false);
          for(const [key, value] of Object.entries($DiocesesList)){
            $('#diocesancalendar').append('<option value="' + key + '">' + value.diocese + '</option>');
          }
        } else {
          $('#diocesancalendar').prop('disabled', true);
        }
        */
        switch( $(ev.currentTarget).val() ) {
          case "VATICAN":
            $('#locale').val('LA');
            $('#epiphany').val('JAN6');
            $('#ascension').val('THURSDAY');
            $('#corpuschristi').val('THURSDAY');
            $('#diocesancalendar').val("");
            $Settings.locale = 'LA';
            $Settings.epiphany = 'JAN6';
            $Settings.ascension = 'THURSDAY';
            $Settings.corpuschristi = 'THURSDAY';
            $Settings.diocesancalendar = '';
            $Settings.nationalcalendar = 'VATICAN';

            $('#calSettingsForm :input').not('#nationalcalendar').not('#year').not('#generateLitCal').prop('disabled', true);
            break;
          case "ITALY":
            $('#locale').val('IT');
            $('#epiphany').val('JAN6');
            $('#ascension').val('SUNDAY');
            $('#corpuschristi').val('SUNDAY');
            $Settings.locale = 'IT';
            $Settings.epiphany = 'JAN6';
            $Settings.ascension = 'SUNDAY';
            $Settings.corpuschristi = 'SUNDAY';
            $Settings.diocesancalendar = '';
            $Settings.nationalcalendar = 'ITALY';
            $('#calSettingsForm :input').not('#diocesancalendar').not('#nationalcalendar').not('#year').not('#generateLitCal').prop('disabled', true);
            $('#diocesancalendar').empty();
            if(Object.keys($DiocesesItaly).length > 0){
              $('#diocesancalendar').prop('disabled', false);
              $('#diocesancalendar').append('<option value=""></option>');
              for(const [key, value] of Object.entries($DiocesesItaly)){
                $('#diocesancalendar').append('<option value="' + key + '">' + value.diocese + '</option>');
              }
            } else {
              $('#diocesancalendar').prop('disabled', true);
            }
            break;
          case "USA":
            $('#locale').val('EN');
            $('#epiphany').val('SUNDAY_JAN2_JAN8');
            $('#ascension').val('SUNDAY');
            $('#corpuschristi').val('SUNDAY');
            $Settings.locale = 'EN';
            $Settings.epiphany = 'SUNDAY_JAN2_JAN8';
            $Settings.ascension = 'SUNDAY';
            $Settings.corpuschristi = 'SUNDAY';
            $Settings.diocesancalendar = '';
            $Settings.nationalcalendar = 'USA';
            $('#calSettingsForm :input').not('#diocesancalendar').not('#nationalcalendar').not('#year').not('#generateLitCal').prop('disabled', true);
            
            //TODO: once the data for the Diocese of Rome has been define through the UI interface
            //      and the relative JSON file created, the following operation should be abstracted for any nation in the list
            //      and not applied here with the hardcoded value "USA"
            //      The logic has been started up above, before the 'switch'
            //      However we have to keep in mind that Rome groups together the celebrations for the whole Lazio region in a single booklet
            //      This would mean that we have to create the ability of creating groups, to group together the data from more than one diocese
            //      Perhaps another value can be added to the index, to indicate a group definition, such that all the diocesan calendars belonging to that group can be pulled...
            $('#diocesancalendar').empty();
            if(Object.keys($DiocesesUSA).length > 0){
              $('#diocesancalendar').prop('disabled', false);
              $('#diocesancalendar').append('<option value=""></option>');
              for(const [key, value] of Object.entries($DiocesesUSA)){
                $('#diocesancalendar').append('<option value="' + key + '">' + value.diocese + '</option>');
              }
            } else {
              $('#diocesancalendar').prop('disabled', true);
            }
            break;
          default:
            $('#calSettingsForm :input').prop('disabled', false);
            $('#diocesancalendar').val("").prop('disabled', true);
            $Settings.nationalcalendar = '';
        }
      });

      $(document).on('change', '#diocesancalendar', ev => { $Settings.diocesancalendar = $(ev.currentTarget).val(); });

      $(document).tooltip({
        items: "[data-tooltip",
        content: el => decodeURI( $(el).attr('data-tooltip') )
      });

      if ($Settings.locale.toLowerCase() === 'la') {
        $('.fc-day').each((idx, el) => {
          $(el).find('a.fc-col-header-cell-cushion').text(dayNamesShort[idx]);
          console.log($(el).find('a.fc-col-header-cell-cushion').text());
        });
      }

    });

  // First, checks if it isn't implemented yet.
  if (!String.prototype.format) {
    String.prototype.format = function(...args) {
      return this.replace(/{(\d+)}/g, (match, number) => { 
        return typeof args[number] != 'undefined'
          ? args[number]
          : match
        ;
      });
    };
  }

  Object.filter = (obj, predicate) => 
    Object.keys(obj)
          .filter( key => predicate(obj[key]) )
          .reduce( (res, key) => (res[key] = obj[key], res), {} );
  </script>

</body>

</html>
